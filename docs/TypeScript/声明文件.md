# å£°æ˜Žæ–‡ä»¶

`.d.ts` æ–‡ä»¶æ˜¯ **TypeScript çš„ç±»åž‹å£°æ˜Žæ–‡ä»¶**ï¼ˆType Declaration Fileï¼‰

## d.tsæ–‡ä»¶

d.tsæ˜¯çº¯ç²¹çš„**ç±»åž‹å£°æ˜Ž**æ–‡ä»¶ï¼Œ**ä¸äº§å‡ºä»»ä½• JS ä»£ç **ã€‚

å£°æ˜Žæ–‡ä»¶çš„ä½œç”¨ï¼š

1. **æä¾›ç±»åž‹ç»™æ²¡æœ‰ç±»åž‹çš„ JS æ–‡ä»¶**

   æ¯”å¦‚ä½ å†™çš„æ˜¯ math.jsï¼ŒJS æœ¬èº«æ²¡æœ‰ç±»åž‹ï¼Œå†™ä¸€ä¸ª math.d.ts å¯ä»¥ç»™ TS æç¤ºç±»åž‹ã€‚

2. **å¯¹å¤–æš´éœ²åº“çš„ç±»åž‹å£°æ˜Ž**

   å¦‚æžœä½ å†™çš„æ˜¯ä¸€ä¸ª npm åŒ…ï¼Œç¼–è¯‘åŽä¼šäº§ç”Ÿä¸€ä¸ªd.tsæ–‡ä»¶å’Œjsæ–‡ä»¶ã€‚d.tsæä¾›ç»™å¼€å‘è€…é˜…è¯»ã€‚TSæºç å°†ä¸ä¼šæ³„éœ²

3. **æ¨¡å—å¢žå¼ºæˆ–å…¨å±€å£°æ˜Ž**

   ç»™çŽ°æœ‰æ¨¡å—åŠ ç±»åž‹ï¼Œæˆ–è€…å£°æ˜Žå…¨å±€å‡½æ•°/å˜é‡ã€‚

:::tip å®‰è£…ç¬¬ä¸‰æ–¹ç±»åž‹æ–‡ä»¶

å¦‚æžœç¬¬ä¸‰æ–¹åº“ä¸å­˜åœ¨ç±»åž‹å£°æ˜Žæ–‡ä»¶ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ `@types/æ¨¡å—å` å®‰è£…

```shell
pnpm i @types/lodash -D
```

:::

## tsæ–‡ä»¶ç±»åž‹

### Script ï¼ˆè„šæœ¬æ¨¡å¼ï¼‰

- tsæ–‡ä»¶ä¸­æ²¡æœ‰ import æˆ– export è¯­å¥çš„æ–‡ä»¶ï¼Œé»˜è®¤å°±æ˜¯è„šæœ¬æ¨¡å¼ã€‚
- æ–‡ä»¶é‡Œçš„é¡¶çº§å˜é‡ã€å£°æ˜Žä¼šè¢«è®¤ä¸ºæ˜¯ **å…¨å±€çš„**ï¼Œå¯èƒ½ä¼šå’Œåˆ«çš„æ–‡ä»¶å†²çªã€‚

å‡å¦‚ä½ æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š

:::code-group

```ts [a.ts]
// a.ts
interface User {
  name: string;
}
```

```ts [b.ts]
// b.ts
interface User {
  id: number;
}
```

```ts [æœ€ç»ˆç±»åž‹]
interface User {
  name: string;
  id: number;
}
```



:::

å› ä¸ºå®ƒä»¬éƒ½æ˜¯ **è„šæœ¬æ¨¡å¼**ï¼ŒTypeScript ä¼šè‡ªåŠ¨æŠŠè¿™ä¸¤ä¸ª User æŽ¥å£åˆå¹¶åˆ°å…¨å±€é‡Œï¼Œå¯¼è‡´å¥‡æ€ªçš„ç±»åž‹æ··æ·†ã€‚

### Moduleï¼ˆæ¨¡å—æ¨¡å¼ï¼‰

- åªè¦æ–‡ä»¶ä¸­å‡ºçŽ°äº† import æˆ– exportï¼Œå®ƒå°±ä¼šè¢«å½“æˆæ¨¡å—ã€‚
- æ¨¡å—é‡Œçš„é¡¶çº§å˜é‡ã€å‡½æ•°ã€æŽ¥å£éƒ½åªåœ¨è¿™ä¸ªæ¨¡å—ä½œç”¨åŸŸé‡Œç”Ÿæ•ˆï¼Œä¸ä¼šæ±¡æŸ“å…¨å±€ã€‚
- å…¶ä»–æ–‡ä»¶æ²¡æœ‰importå¯¼å…¥è¯¥æ–‡ä»¶ï¼Œé‚£ä¹ˆè¯¥æ–‡ä»¶å°±ä¸ä¼šè¢«TSç¼–è¯‘ã€‚

### Script -> Module

å†™ `export {}`; å°±èƒ½**å¼ºåˆ¶æŠŠæ–‡ä»¶æ ‡è®°ä¸ºæ¨¡å—**ã€‚

```ts
// types/user.d.ts
export {};          // â† æ–‡ä»¶å˜æˆæ¨¡å—
interface User {    // â† æ—¢æ²¡ exportï¼Œä¹Ÿä¸åœ¨å…¨å±€
  name: string;
}
```





## declare

`declare` æ˜¯ä¸€ä¸ªå…³é”®å­—ï¼Œç”¨äºŽ**å£°æ˜Ž**æŸä¸ªæ ‡è¯†ç¬¦ï¼ˆå˜é‡ã€å‡½æ•°ã€ç±»ã€æ¨¡å—ç­‰ï¼‰çš„å­˜åœ¨ï¼Œä½†**ä¸ç»™å‡ºå…·ä½“å®žçŽ°**ã€‚å®ƒå‘Šè¯‰ TypeScriptï¼šâ€œ**è¿™ä¸ªä¸œè¥¿æ˜¯å­˜åœ¨çš„ï¼Œä½†å®ƒåœ¨åˆ«çš„åœ°æ–¹å®šä¹‰**ï¼Œä½ åˆ«æŠ¥é”™ã€‚â€ã€‚declareå…³é”®å­—å¯ä»¥åœ¨tsæ–‡ä»¶æˆ–è€….d.tsä¸­ä½¿ç”¨ã€‚

### å£°æ˜Žå˜é‡ / å¸¸é‡

```ts
declare const VERSION: string;
declare let count: number;
declare var window: Window;
```

### å£°æ˜Žå‡½æ•°

```ts
declare function alert(message?: any): void;
declare function sum(a: number, b: number): number;
```





### å£°æ˜Žå…¨å±€ç±»åž‹

```ts
export {}
declare global {
  interface Window {
    myAppVersion: string;
  }
}
```

è„šæœ¬æ¨¡å¼ä¸‹ä¼šå¿½ç•¥`declare global{}ï¼Œ`å› ä¸ºè„šæœ¬æ¨¡å¼å°±å·²ç»æ˜¯å…¨å±€ä½œç”¨åŸŸäº†ï¼ŒTSç¼–è¯‘å™¨ä¸ä¼šè®¤è¯†`declare global{}`ï¼Œå› æ­¤éœ€è¦å°†è„šæœ¬æ¨¡å¼åˆ‡æ¢æˆæ¨¡å—æ¨¡å¼ï¼Œå…¨å±€ç±»åž‹å£°æ˜Žæ‰ä¼šç”Ÿæ•ˆã€‚ä½ ä¹Ÿå¯ä»¥ç›´æŽ¥åœ¨è„šæœ¬æ¨¡å¼ä¸‹å£°æ˜Žå…¨å±€ç±»åž‹ï¼š

```ts
  interface Window {
    myAppVersion: string;
  }
```



###  å£°æ˜Žæ¨¡å—

- å£°æ˜Žå…¨å±€å¼æ¨¡å—ç±»åž‹

```ts
// types/a.d.ts   å…¨å±€å£°æ˜Ž
declare module 'my-lib' {
  export function f1(): void;
}
```

åªè¦ `types/a.d.ts` åœ¨ `tsconfig.include` é‡Œï¼Œ**ä»»ä½•åœ°æ–¹** `import { f1 } from 'my-lib'` éƒ½èƒ½ç”¨ã€‚

- å£°æ˜Žå¯åˆå¹¶å¼æ¨¡å—ç±»åž‹

å¦‚æžœ **æ²¡æœ‰ä»»ä½• TS æ–‡ä»¶**å†™ `import './types/b'` æˆ– `import 'types/b'`ï¼Œé‚£ä¹ˆ `f2` **æ°¸è¿œä¸å­˜åœ¨**ï¼Œä¼šæŠ¥
`TS2305: Module '"my-lib"' has no exported member 'f2'.`

```ts
// types/b.d.ts   æ¨¡å—çº§æ‰©å……
export {};                       // æˆ–ä»»ä½• import/export
declare module 'my-lib' {
  export function f2(): void;
}
```



```ts
// components.d.ts
declare module 'vue' {
  export interface GlobalComponents {
    CaseButton: typeof import('./../components/CaseButton.vue')['default']
  }
}

// ðŸ”‘ å…³é”®ï¼šè®©æœ¬æ–‡ä»¶æˆä¸ºã€Œæ¨¡å—ã€ï¼Œé¿å…æ±¡æŸ“å…¨å±€
export {}
```

æ²¡æœ‰ `export {}` æ—¶ï¼ŒTS ä¼šæŠŠå®ƒå½“æˆâ€œå…¨å±€å£°æ˜Žâ€ï¼ŒåŽç»­ `runtime-dom` å†æƒ³å†™ `declare module 'vue' { ... }` å°±ä¼šå†²çªï¼›
åŠ äº† `export {}`ï¼Œæ–‡ä»¶å¤„äºŽ **æ¨¡å—ä½œç”¨åŸŸ**ï¼ŒåŒåæ¨¡å—å£°æ˜Žå°±èƒ½è¢« TS åˆå¹¶ï¼ˆaugmentï¼‰â€”â€”è¿™æ­£æ˜¯ Vue æƒ³è¦çš„â€œæ’ä»¶å¼â€ç±»åž‹æ‰©å……æœºåˆ¶ã€‚

:::tip TypeScript æ€Žä¹ˆç†è§£æ¨¡å—ï¼Ÿ

å½“ä½ å†™ï¼š

```ts
import { doSomething } from 'my-module';
```

TypeScript ä¼šåŽ»æŸ¥ï¼š

- æ˜¯å¦æ˜¯tsæ–‡ä»¶
- æ˜¯å¦å­˜åœ¨declare module 'my-module'
- é‡Œé¢æœ‰æ²¡æœ‰ **å¯¼å‡º `doSomething` çš„ç±»åž‹ä¿¡æ¯**ï¼Ÿ

å¦‚æžœæ²¡æœ‰ï¼ŒTS å°±ä¼šæŠ¥é”™ï¼š**â€œæ‰¾ä¸åˆ°æ¨¡å— â€˜my-moduleâ€™ çš„ç±»åž‹å®šä¹‰ã€‚â€**

:::

 `declare module` é‡Œå†™çš„ç±»åž‹éœ€è¦å’Œæ¨¡å—ä¸­å¯¹åº”çš„æˆå‘˜åå­—ç›¸åŒï¼Œç±»åž‹çš„å¯¼å‡ºæ–¹å¼è¦å’Œæ¨¡å—ä¸­çš„å¯¼å‡ºæ–¹å¼ç›¸åŒã€‚è¿™æ ·TSç³»ç»Ÿå°±èƒ½è¯†åˆ«æ¨¡å—ä¸­æˆå‘˜çš„ç±»åž‹ã€‚

### å£°æ˜ŽæŽ¥å£æˆ–ç±»åž‹

```ts
// types.d.ts
declare interface Window {
  __INITIAL_DATA__: any;
}
```



## ç¤ºä¾‹



:::code-group

```ts [express.ts]
// å¯¼å…¥expressæ¨¡å—
import express from 'express';

// åˆ›å»ºä¸€ä¸ªexpressåº”ç”¨å®žä¾‹
const app = express();

// è®¾ç½®ä¸€ä¸ªè·¯ç”±ï¼Œå“åº”æ ¹è·¯å¾„çš„GETè¯·æ±‚
app.get('/', (req, res) => {
  res.send('Hello, Express!');
});

// ç›‘å¬ç«¯å£3000ï¼Œå¯åŠ¨æœåŠ¡å™¨
app.listen(3000, () => {
  console.log('Server is running on http://localhost:3000');
});

```

```ts [express.d.ts]
declare module 'express' {
  // å®šä¹‰ express ç›¸å…³ç±»åž‹
  export type RequestHandler = (req: Request, res: Response, next: NextFunction) => void;
  
  export interface Request {
    body: any;
    params: { [key: string]: string };
    query: { [key: string]: string };
    // å…¶ä»–å¸¸ç”¨å±žæ€§å¯ä»¥ç»§ç»­æ‰©å±•...
  }

  export interface Response {
    send: (body: any) => this;
    status: (code: number) => this;
    json: (data: any) => this;
    // å…¶ä»–å¸¸ç”¨æ–¹æ³•å¯ä»¥ç»§ç»­æ‰©å±•...
  }

  export interface NextFunction {
    (): void;
  }

  export interface Express {
    get: (path: string, handler: RequestHandler) => void;
    listen: (port: number, callback: () => void) => void;
    use: (middleware: RequestHandler) => void;
  }

  export function express(): Express;
}

```



:::
