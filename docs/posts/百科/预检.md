# 预检 OPTIONS



## 什么是预检请求？

当浏览器认为请求“可能不安全”时，会先发：

```js
OPTIONS /api/xxx
```

请求头：

```js
Origin: http://www.a.com
Access-Control-Request-Method: PUT
Access-Control-Request-Headers: Authorization
```

服务器响应如果：

```js
Access-Control-Allow-Origin
Access-Control-Allow-Methods
Access-Control-Allow-Headers
```

浏览器才会真正发实际请求。

## 非简单请求

只要以下任一条件满足就会触发预检

### 请求方法不是 GET / POST / HEAD

```js
PUT
DELETE
PATCH
```

### 使用了自定义请求头

自定义请求头

```js
axios.get('/api', {
  headers: {
    Authorization: 'Bearer xxx'
  }
})
```

### 当Content-Type

`Content-Type`虽然不是自定义请求头，但是也有额外限制。

只有当Content-Type值是下面三种时，才是“简单请求”：

```js
application/x-www-form-urlencoded
multipart/form-data
text/plain
```

其他情况都属于非简单请求：

```js
Content-Type:application/json
```



## 预检响应

浏览器通过检查 **预检请求（OPTIONS）的响应头** 来判断服务器是否允许这次跨域请求。

```js
OPTIONS /api/user/1
Origin: http://localhost:5173
Access-Control-Request-Method: DELETE
```

